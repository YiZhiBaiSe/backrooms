<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>后室抽卡模拟器 V2 - 比特币版</title>
    <style>
        /*region Google Fonts Import */
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400&display=swap');
        /*endregion*/

        /*region CSS Variables */
        :root {
            /* Core Cyberpunk Colors */
            --cyber-bg: #0a0a1a;             /* Deep space blue/black */
            --cyber-primary: #00ffff;        /* Bright Cyan */
            --cyber-secondary: #ff00ff;      /* Bright Magenta */
            --cyber-accent: #ffff00;         /* Bright Yellow */
            --cyber-text: #e0e0e0;           /* Light grey/white text */
            --cyber-text-darker: #a0a0a0;    /* Darker grey text */
            --cyber-border-glow: rgba(0, 255, 255, 0.5); /* Cyan glow */
            --cyber-shadow: rgba(0, 0, 0, 0.6);

            /* Rarity Colors */
            --rarity-common: #aaaaaa;       /* Grey */
            --rarity-uncommon: #4caf50;      /* Green */
            --rarity-rare: #2196f3;          /* Blue */
            --rarity-epic: #9c27b0;           /* Purple */
            --rarity-legendary: #ffc107;     /* Gold */

            /* UI Element Specifics */
            --bitcoin-bg: rgba(255, 193, 7, 0.1);  /* Light gold transparent bg */
            --bitcoin-border: var(--rarity-legendary);
            --bitcoin-text: var(--rarity-legendary);
            --button-disabled-opacity: 0.4;
        }
        /*endregion*/

        /*region Base Body & Background Styles */
        body {
            background-color: var(--cyber-bg);
            color: var(--cyber-text);
            font-family: 'Noto Sans SC', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            overflow-y: auto;   /* Allow vertical scroll */
            overflow-x: hidden;   /* Prevent horizontal scroll */
            position: relative; /* Needed for pseudo-elements */
            font-size: 16px; /* Base font size */
        }

        /* Cyber Lines Background Animation */
        /* These pseudo-elements create the moving grid effect */
        body::before, body::after {
            content: '';
            position: fixed; /* Use fixed so they don't scroll with content */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1; /* Place behind all content */
        }

        /* Diagonal cyan lines */
        body::before {
            background:
                linear-gradient(45deg, transparent 49.5%, var(--cyber-primary) 49.5%, var(--cyber-primary) 50.5%, transparent 50.5%),
                linear-gradient(-45deg, transparent 49.5%, var(--cyber-primary) 49.5%, var(--cyber-primary) 50.5%, transparent 50.5%);
            background-size: 70px 70px; /* Grid size */
            opacity: 0.08; /* Subtle effect */
            animation: moveLines 12s linear infinite;
        }

        /* Horizontal/Vertical magenta lines */
        body::after {
             background:
                linear-gradient(0deg, transparent 49.5%, var(--cyber-secondary) 49.5%, var(--cyber-secondary) 50.5%, transparent 50.5%),
                linear-gradient(90deg, transparent 49.5%, var(--cyber-secondary) 49.5%, var(--cyber-secondary) 50.5%, transparent 50.5%);
            background-size: 90px 90px; /* Different grid size */
            opacity: 0.06; /* Even more subtle */
            animation: moveLinesReverse 18s linear infinite; /* Slower, different direction */
        }

        /* Keyframes for background line movement */
        @keyframes moveLines {
            0% { background-position: 0 0; }
            100% { background-position: 140px 70px; } /* Moves diagonally */
        }
         @keyframes moveLinesReverse {
            0% { background-position: 0 0; }
            100% { background-position: -180px -90px; } /* Moves diagonally opposite */
        }
        /*endregion*/

        /*region Main Container & Title */
        .simulator-container {
            text-align: center;
            padding: 30px 40px; /* More horizontal padding */
            background: rgba(10, 10, 30, 0.85); /* Slightly less transparent */
            border: 1px solid var(--cyber-primary);
            box-shadow: 0 0 20px var(--cyber-border-glow), inset 0 0 15px var(--cyber-secondary);
            border-radius: 12px; /* Slightly more rounded */
            margin-top: 80px; /* More space from top due to Bitcoin display */
            margin-bottom: 50px;
            position: relative;
            z-index: 1;
            max-width: 90%; /* Max width */
            width: 1100px; /* Fixed width for better grid control on large screens */
            box-sizing: border-box;
        }

        /* Main title styling */
        h1 {
            font-family: 'Orbitron', sans-serif;
            color: var(--cyber-primary);
            font-size: 2.8em; /* Adjusted size */
            text-shadow:
                0 0 5px var(--cyber-primary),
                0 0 10px var(--cyber-primary),
                0 0 15px var(--cyber-secondary),
                0 0 20px var(--cyber-secondary);
            margin-top: 10px;
            margin-bottom: 40px; /* More space below title */
            letter-spacing: 3px; /* Wider spacing */
            font-weight: 700;
        }
        /*endregion*/

        /*region Button Styles */
        .button-container {
            display: flex;
            justify-content: center;
            gap: 30px; /* Space between buttons */
            margin-bottom: 40px; /* Space below buttons */
            flex-wrap: wrap; /* Allow buttons to wrap on smaller screens */
        }

        .draw-button {
            font-family: 'Orbitron', sans-serif;
            background-color: transparent;
            border: 2px solid; /* Color set below */
            padding: 15px 30px;
            font-size: 1.1em; /* Slightly smaller */
            font-weight: 700;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s ease;
            text-shadow: 0 0 3px; /* Color set below */
            box-shadow: 0 0 8px, inset 0 0 5px rgba(255, 255, 255, 0.3); /* Color set below */
            min-width: 250px; /* Ensure buttons have decent width */
        }

        /* Normal Pool Button */
        .normal-button {
            color: var(--cyber-accent);
            border-color: var(--cyber-accent);
            text-shadow-color: var(--cyber-accent);
            box-shadow-color: var(--cyber-accent);
        }
        .normal-button:hover {
            background-color: var(--cyber-accent);
            color: var(--cyber-bg);
            box-shadow: 0 0 15px var(--cyber-accent), 0 0 25px var(--cyber-accent), inset 0 0 8px rgba(0, 0, 0, 0.7);
            text-shadow: none;
        }

        /* Premium Pool Button */
        .premium-button {
            color: var(--rarity-legendary);
            border-color: var(--rarity-legendary);
            text-shadow-color: var(--rarity-legendary);
            box-shadow-color: var(--rarity-legendary);
        }
        .premium-button:not(:disabled):hover {
            background-color: var(--rarity-legendary);
            color: var(--cyber-bg);
            box-shadow: 0 0 15px var(--rarity-legendary), 0 0 25px var(--rarity-legendary), inset 0 0 8px rgba(0, 0, 0, 0.7);
            text-shadow: none;
        }

        /* Active (Pressed) State */
        .draw-button:active {
            transform: scale(0.96); /* Slightly less pronounced effect */
            filter: brightness(0.9);
        }

        /* Disabled State Styling */
        .draw-button:disabled {
            cursor: not-allowed;
            opacity: var(--button-disabled-opacity);
            filter: grayscale(50%);
            box-shadow: none;
            /* Prevent hover effects on disabled state */
            pointer-events: none;
        }
        /*endregion*/

        /*region Card Display & Card Styles */
        .card-display {
            display: grid;
            /* Aim for 5 columns, but allow flexibility */
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px; /* Increased gap */
            margin-top: 30px;
            min-height: 250px;
            perspective: 1200px; /* Enhanced 3D perspective */
            padding: 10px; /* Add padding inside the display area */
        }

        /* Individual Card Styling */
        .card {
            background: linear-gradient(145deg, rgba(30, 30, 50, 0.95), rgba(40, 40, 60, 0.9)); /* Subtle gradient */
            border: 2px solid; /* Rarity color set by class */
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 5px 10px var(--cyber-shadow);
            text-align: left;
            opacity: 0; /* Start hidden for animation */
            animation: fadeInCard 0.6s ease-out forwards; /* Slower fade-in */
            transform-style: preserve-3d;
            transition: transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1), box-shadow 0.4s cubic-bezier(0.25, 0.8, 0.25, 1); /* Smoother transition */
            position: relative;
            overflow: hidden; /* Prevent glow spill */
            display: flex;
            flex-direction: column;
            min-height: 280px; /* Increased min-height for more content */
            box-sizing: border-box;
        }

        /* Card Fade-in Animation Keyframes */
        @keyframes fadeInCard {
            from {
                opacity: 0;
                transform: translateY(30px) rotateX(-15deg) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) rotateX(0deg) scale(1);
            }
        }

        /* Staggered Animation Delays (applied via JS now for flexibility) */
        /* Example delays (these specific nth-child rules are removed in favor of JS delay calculation) */
        /* .card:nth-child(1) { animation-delay: 0.6s; } ... etc */

        /* Card Hover Effect */
        .card:hover {
             transform: translateY(-8px) scale(1.04) rotateX(5deg); /* More pronounced hover */
             box-shadow: 0 12px 24px rgba(0, 0, 0, 0.7);
             z-index: 5; /* Bring hovered card to front */
        }

        /* Card Content Sections */
        .card-content {
            flex-grow: 1; /* Allows description to fill space */
            margin-bottom: 10px;
        }

        .card-name {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.15em; /* Slightly larger */
            font-weight: 700;
            margin-bottom: 8px;
            /* Rarity color applied dynamically */
        }

        .card-type {
            font-size: 0.85em;
            color: var(--cyber-primary); /* Consistent cyan for type */
            margin-bottom: 12px;
            font-style: italic;
            font-weight: 300;
        }

        .card-description {
            font-size: 0.9em;
            color: var(--cyber-text);
            line-height: 1.5; /* Improved readability */
            margin-bottom: 10px;
            font-weight: 300;
        }

        .card-rarity {
            font-size: 0.85em;
            font-weight: bold;
            text-align: right;
            margin-top: auto; /* Pushes to bottom in flex container */
            /* Rarity color applied dynamically */
        }
        /*endregion*/

        /*region Rarity Specific Styles */
        /* Border Colors */
        .rarity-common { border-color: var(--rarity-common); }
        .rarity-uncommon { border-color: var(--rarity-uncommon); }
        .rarity-rare { border-color: var(--rarity-rare); }
        .rarity-epic { border-color: var(--rarity-epic); }
        .rarity-legendary { border-color: var(--rarity-legendary); }

        /* Text Colors for Name & Rarity */
        .rarity-common .card-name, .rarity-common .card-rarity { color: var(--rarity-common); }
        .rarity-uncommon .card-name, .rarity-uncommon .card-rarity { color: var(--rarity-uncommon); }
        .rarity-rare .card-name, .rarity-rare .card-rarity { color: var(--rarity-rare); }
        .rarity-epic .card-name, .rarity-epic .card-rarity { color: var(--rarity-epic); text-shadow: 0 0 4px var(--rarity-epic); }
        .rarity-legendary .card-name, .rarity-legendary .card-rarity { color: var(--rarity-legendary); text-shadow: 0 0 6px var(--rarity-legendary); }

        /* Rarity Glow Effect (using ::before pseudo-element) */
        /* Only applied to Rare and above */
        .rarity-rare::before,
        .rarity-epic::before,
        .rarity-legendary::before {
            content: '';
            position: absolute;
            top: -4px; left: -4px; right: -4px; bottom: -4px; /* Extends slightly beyond border */
            border-radius: 13px; /* Match card radius + border */
            z-index: -1; /* Behind card content */
            opacity: 0; /* Start hidden, shown on higher rarities */
            transition: opacity 0.4s ease;
        }

        .rarity-rare::before { box-shadow: 0 0 10px 3px var(--rarity-rare); opacity: 0.6; }
        .rarity-epic::before { box-shadow: 0 0 14px 4px var(--rarity-epic); opacity: 0.7; }
        .rarity-legendary::before {
            box-shadow: 0 0 18px 5px var(--rarity-legendary);
            opacity: 0.8;
            animation: pulseLegendary 2.5s infinite alternate ease-in-out; /* Smoother pulsing */
        }

        /* Legendary Pulse Animation */
        @keyframes pulseLegendary {
            from {
                box-shadow: 0 0 18px 5px var(--rarity-legendary);
                opacity: 0.7;
            }
            to {
                box-shadow: 0 0 28px 7px var(--rarity-legendary);
                opacity: 0.95;
            }
        }
        /*endregion*/

        /*region Draw Animation Overlay */
        /* This covers the screen during the draw 'reveal' */
        .draw-animation-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 10, 0.8); /* Darker overlay */
            z-index: 100; /* High z-index to cover everything */
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s ease-in-out;
        }
        .draw-animation-overlay.active {
             opacity: 1;
             pointer-events: auto; /* Allow interaction if needed, though usually brief */
        }

        /* Container for converging lines */
        .converging-lines {
            position: relative;
            width: 350px; /* Larger animation area */
            height: 350px;
        }

        /* Individual line styling */
        .line {
            position: absolute;
            background-color: var(--cyber-primary);
            box-shadow: 0 0 6px var(--cyber-primary), 0 0 12px var(--cyber-secondary);
            opacity: 0; /* Start invisible */
            transform-origin: center center;
        }

        /* Line Animations - Keeping existing simple converge for now */
        /* More complex animations could be added here */
        .line.l1 { top: 50%; left: -60px; width: 60px; height: 3px; animation: converge1 0.9s ease-out forwards 0.1s; }
        .line.l2 { top: 50%; right: -60px; width: 60px; height: 3px; animation: converge2 0.9s ease-out forwards 0.1s; }
        .line.l3 { left: 50%; top: -60px; height: 60px; width: 3px; animation: converge3 0.9s ease-out forwards 0.2s; }
        .line.l4 { left: 50%; bottom: -60px; height: 60px; width: 3px; animation: converge4 0.9s ease-out forwards 0.2s; }
        .line.l5 { top: 0; left: 0; width: 4px; height: 4px; transform: translate(-60px, -60px); animation: convergeDiag1 1.0s ease-in-out forwards 0.3s; background-color: var(--cyber-accent); box-shadow: 0 0 6px var(--cyber-accent); border-radius: 50%; }
        .line.l6 { top: 0; right: 0; width: 4px; height: 4px; transform: translate(60px, -60px); animation: convergeDiag2 1.0s ease-in-out forwards 0.3s; background-color: var(--cyber-accent); box-shadow: 0 0 6px var(--cyber-accent); border-radius: 50%; }
        .line.l7 { bottom: 0; left: 0; width: 4px; height: 4px; transform: translate(-60px, 60px); animation: convergeDiag3 1.0s ease-in-out forwards 0.3s; background-color: var(--cyber-accent); box-shadow: 0 0 6px var(--cyber-accent); border-radius: 50%; }
        .line.l8 { bottom: 0; right: 0; width: 4px; height: 4px; transform: translate(60px, 60px); animation: convergeDiag4 1.0s ease-in-out forwards 0.3s; background-color: var(--cyber-accent); box-shadow: 0 0 6px var(--cyber-accent); border-radius: 50%; }

        /* Keyframes for Converging Lines */
        @keyframes converge1 { 0% { left: -60px; opacity: 1; transform: translateX(0) scaleX(1); } 100% { left: 50%; opacity: 0; transform: translateX(-50%) scaleX(0.1); } }
        @keyframes converge2 { 0% { right: -60px; opacity: 1; transform: translateX(0) scaleX(1); } 100% { right: 50%; opacity: 0; transform: translateX(50%) scaleX(0.1); } }
        @keyframes converge3 { 0% { top: -60px; opacity: 1; transform: translateY(0) scaleY(1); } 100% { top: 50%; opacity: 0; transform: translateY(-50%) scaleY(0.1); } }
        @keyframes converge4 { 0% { bottom: -60px; opacity: 1; transform: translateY(0) scaleY(1); } 100% { bottom: 50%; opacity: 0; transform: translateY(50%) scaleY(0.1); } }
        @keyframes convergeDiag1 { 0% { opacity: 1; transform: translate(-60px, -60px) scale(1.2); } 100% { opacity: 0; transform: translate(calc(50% - 2px), calc(50% - 2px)) scale(0); } } /* Target center */
        @keyframes convergeDiag2 { 0% { opacity: 1; transform: translate(60px, -60px) scale(1.2); } 100% { opacity: 0; transform: translate(calc(-50% + 2px), calc(50% - 2px)) scale(0); } }
        @keyframes convergeDiag3 { 0% { opacity: 1; transform: translate(-60px, 60px) scale(1.2); } 100% { opacity: 0; transform: translate(calc(50% - 2px), calc(-50% + 2px)) scale(0); } }
        @keyframes convergeDiag4 { 0% { opacity: 1; transform: translate(60px, 60px) scale(1.2); } 100% { opacity: 0; transform: translate(calc(-50% + 2px), calc(-50% + 2px)) scale(0); } }
        /*endregion*/

        /*region Bitcoin Display */
        .bitcoin-display {
            position: fixed; /* Fixed position on screen */
            top: 15px;
            right: 20px;
            background: var(--bitcoin-bg);
            border: 1px solid var(--bitcoin-border);
            padding: 8px 15px;
            border-radius: 5px;
            color: var(--bitcoin-text);
            font-family: 'Orbitron', sans-serif;
            font-size: 1em;
            font-weight: 700;
            z-index: 101; /* Above overlay during animation */
            box-shadow: 0 0 10px var(--bitcoin-border);
            transition: transform 0.3s ease, box-shadow 0.3s ease; /* Animation on update */
        }
        .bitcoin-display.updated { /* Class added briefly on update */
             transform: scale(1.1);
             box-shadow: 0 0 15px var(--bitcoin-border), 0 0 25px var(--bitcoin-border);
        }
        /*endregion*/

        /*region Responsive Design */
        @media (max-width: 1200px) {
            .simulator-container {
                width: 95%; /* Use percentage width */
                max-width: none; /* Remove fixed width */
                padding: 25px 30px;
            }
             .card-display {
                grid-template-columns: repeat(auto-fit, minmax(190px, 1fr)); /* Adjust minmax */
            }
        }

        @media (max-width: 768px) {
            body { font-size: 15px; }
            h1 { font-size: 2.2em; letter-spacing: 2px; margin-bottom: 30px;}
            .simulator-container { padding: 20px; margin-top: 70px; }
            .button-container { flex-direction: column; gap: 15px; align-items: center; margin-bottom: 30px;}
            .draw-button { min-width: 80%; padding: 12px 20px; font-size: 1em;}
            .card-display { grid-template-columns: repeat(auto-fit, minmax(170px, 1fr)); gap: 15px; }
            .card { min-height: 260px; } /* Adjust height */
            .bitcoin-display { font-size: 0.9em; padding: 6px 10px; right: 10px; top: 10px;}
        }

        @media (max-width: 480px) {
            body { font-size: 14px; }
            h1 { font-size: 1.8em; }
            .simulator-container { padding: 15px; }
            .card-display { grid-template-columns: 1fr; } /* Single column */
            .card { min-height: auto; } /* Auto height in single column */
            .card-name { font-size: 1.1em; }
            .card-description { font-size: 0.85em; }
        }
        /*endregion*/

    </style>
</head>
<body>

<!-- 邮箱按钮 -->
<button id="mailButton" class="draw-button premium-button" style="position: fixed; top: 15px; left: 20px; z-index: 102;">📬 邮箱</button>

<!-- 邮箱弹窗 -->
<div id="mailModal" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
    background: rgba(20, 20, 40, 0.95); border: 2px solid var(--cyber-primary); border-radius: 10px;
    padding: 30px; z-index: 200; width: 90%; max-width: 500px; box-shadow: 0 0 20px var(--cyber-border-glow); color: var(--cyber-text);">
    <h2 style="color: var(--cyber-accent); font-family: 'Orbitron', sans-serif;">🎉 感谢你的游玩！</h2>
    <p style="margin-top: 10px; line-height: 1.8;">作为开发团队的一点心意，已附赠 <strong style="color: var(--rarity-legendary);">5 枚比特币</strong> 到你的账户中。</p>
    <p>祝你在后室中好运连连，抽到传说中的“杰瑞”！</p>
    <button id="closeMail" class="draw-button normal-button" style="margin-top: 20px;">关闭</button>
</div>


    <div class="bitcoin-display" id="bitcoinDisplay">比特币: 0</div>

    <div class="simulator-container">
        <h1>后室抽卡模拟器</h1>

        <div class="button-container">
            <button class="draw-button normal-button" id="drawNormalButton">抽取普通卡包 (10张, 免费)</button>
            <button class="draw-button premium-button" id="drawPremiumButton" disabled>抽取高级卡包 (10张, 1 BTC)</button>
        </div>

        <div class="card-display" id="cardDisplay">
            </div>
    </div>

    <div class="draw-animation-overlay" id="drawAnimationOverlay">
        <div class="converging-lines">
            <div class="line l1"></div> <div class="line l2"></div>
            <div class="line l3"></div> <div class="line l4"></div>
            <div class="line l5"></div> <div class="line l6"></div>
            <div class="line l7"></div> <div class="line l8"></div>
        </div>
    </div>

    <script>
        /**
         * Backrooms Card Simulator V2 Script
         * Includes Bitcoin currency, normal/premium pools, and expanded card set.
         * Uses localStorage for Bitcoin persistence.
         */

        //---------------------------------------------------------------------
        // Configuration & Constants
        //---------------------------------------------------------------------

        const NORMAL_PACK_SIZE = 10;
        const PREMIUM_PACK_SIZE = 10;
        const PREMIUM_PACK_COST = 1; // Cost in Bitcoin
        const BITCOIN_CHANCE_PER_NORMAL_PACK = 0.10; // 10% chance
        const ANIMATION_DURATION = 1300; // ms (slightly longer than longest animation)
        const CARD_FADE_BASE_DELAY = 500; // ms (base delay before first card fades in)
        const CARD_FADE_INCREMENT = 100; // ms (delay increment per card)

        // Local Storage Key
        const LOCAL_STORAGE_KEY = 'backrooms_bitcoin_v2';

        //---------------------------------------------------------------------
        // Card Data Definition (Expanded Pool)
        //---------------------------------------------------------------------
        // Note: Descriptions are kept relatively concise for card format.
        // More detailed lore can be found on Backrooms wikis.
        const cardPool = [
            // Common (灰色) - Approx 55-60% (Adjusted for more cards)
            // Basic elements, common entities/levels/items
            { name: "流浪者", type: "人类", rarity: "Common", description: "迷失在后室中的普通人，挣扎求存，试图寻找同伴或出路。" },
            { name: "杏仁水 (标准装)", type: "物品", rarity: "Common", description: "基础补给品，略带甜味，能缓解口渴和轻微精神影响。" },
            { name: "MEG 新手哨兵", type: "组织成员 (MEG)", rarity: "Common", description: "主要探索者团体MEG的初级成员，负责基础巡逻和数据记录。" },
            { name: "Level 0: 大厅", type: "层级", rarity: "Common", description: "标志性的起点。单调的黄色房间，嗡鸣的灯光，潮湿的地毯气味。" },
            { name: "钝人 (Duller)", type: "实体", rarity: "Common", description: "缓慢、无特征的人形实体，通常无害，但群体聚集时需小心。" },
            { name: "Level 1: 宜居地带", type: "层级", rarity: "Common", description: "巨大的仓库般空间，有稳定的电力和偶尔的补给点，相对安全。" },
            { name: "猎犬 (Hound)", type: "实体", rarity: "Common", description: "具有攻击性的犬类实体，依靠声音和气味追踪，通常成群活动。" },
            { name: "损坏的终端", type: "交互点", rarity: "Common", description: "偶尔能找到的旧式计算机终端，大部分信息已丢失或损坏。" },
            { name: "油布", type: "物品", rarity: "Common", description: "一块普通的油布，有时能提供暂时的庇护或用于简单的伪装。" },
            { name: "Level 2: 管网迷宫", type: "层级", rarity: "Common", description: "充斥着滚烫管道和蒸汽的维护通道，环境恶劣，容易迷路。" },
            { name: "荧光棒", type: "物品", rarity: "Common", description: "一次性光源，提供有限时间的照明，有时能吸引或驱赶特定实体。" },
            { name: "成年面灵", type: "实体", rarity: "Common", description: "成熟形态的面部空白实体，比幼体更具威胁性，行为更加难以预测。" },
            { name: "一小袋火柴", type: "物品", rarity: "Common", description: "基础点火工具，在潮湿环境中可能失效，但聊胜于无。" },
            { name: "MEG 后勤人员", type: "组织成员 (MEG)", rarity: "Common", description: "负责维护前哨站和运输物资的MEG成员，通常不参与一线探索。" },
            { name: "Level 3: 发电站", type: "层级", rarity: "Common", description: "狭窄的走廊和巨大的发电机房，持续的噪音和电弧可能造成危险。" },
            { name: "罐装豆子", type: "物品", rarity: "Common", description: "一种常见的食物补给，味道平淡，但能提供必要的能量。" },
            { name: "幼年面灵", type: "实体", rarity: "Common", description: "孩童形态的面部空白实体，好奇心强，有时会模仿他人行为。" },
            { name: "破损的地图碎片", type: "信息", rarity: "Common", description: "一张几乎无法辨认的地图残片，可能指向某个区域，也可能毫无用处。" },

            // Uncommon (绿色) - Approx 25%
            // More dangerous/useful elements, notable but not critical lore points
            { name: "窃皮者 (Skin-Stealer)", type: "实体", rarity: "Uncommon", description: "模仿人类外形的实体，会剥下受害者的皮肤并穿戴，难以分辨。" },
            { name: "MEG 调查员", type: "组织成员 (MEG)", rarity: "Uncommon", description: "经验相对丰富的MEG成员，负责深入探索、记录异常现象和实体。" },
            { name: "笑魇 (Smiler)", type: "实体", rarity: "Uncommon", description: "潜伏在黑暗中的发光笑脸和牙齿，通常只在无光环境中构成威胁。" },
            { name: "Level 4: 废弃办公室", type: "层级", rarity: "Uncommon", description: "无尽延伸的空旷办公楼层，据说有“窗户”实体出没，需要杏仁水。" },
            { name: "皇家口粮", type: "物品", rarity: "Uncommon", description: "效果优于杏仁水的高级补给品，由Backrooms Native Trade Group (B.N.T.G.) 生产。" },
            { name: "UEC 通讯技术员", type: "组织成员 (UEC)", rarity: "Uncommon", description: "联合探索者联盟（UEC）的技术人员，专注于维护和建立跨层级通讯。" },
            { name: "爬行生物 (Crawler)", type: "实体", rarity: "Uncommon", description: "在通风管道和狭窄空间中快速移动的节肢状实体，具有攻击性。" },
            { name: "Level 5: 恐怖旅馆", type: "层级", rarity: "Uncommon", description: "装饰华丽但气氛诡异的永恒旅馆，据说居住着“The Beast”。" },
            { name: "液态寂静", type: "物品/现象", rarity: "Uncommon", description: "一种能吸收声音的奇异液体，涂抹后可大幅降低噪音。" },
            { name: "MEG 前哨站补给箱", type: "交互点", rarity: "Uncommon", description: "MEG设立的补给点，可能含有杏仁水、食物或简单工具。" },
            { name: "B.N.T.G. 商人", type: "组织成员 (B.N.T.G.)", rarity: "Uncommon", description: "后室原生贸易集团的成员，通常在较安全的层级进行物品交易。" },
            { name: "Level 6: 熄灯", type: "层级", rarity: "Uncommon", description: "一个完全黑暗的层级，方向感极易丧失，潜藏着依赖黑暗的实体。" },
            { name: "记忆蠕虫 (Memory Worm)", type: "实体", rarity: "Uncommon", description: "微小的蠕虫状实体，接触后会吞噬或扭曲受害者的记忆。" },
            { name: "防毒面具", type: "物品", rarity: "Uncommon", description: "可以过滤部分有害气体和孢子，在特定污染层级非常有用。" },
            { name: "Level 11: 无尽城市", type: "层级", rarity: "Uncommon", description: "一个巨大的、风格随机的现代城市景观，似乎永无止境。" },
            { name: "派对帽 =) ", type: "物品?", rarity: "Uncommon", description: "一个看似普通的派对帽，戴上它可能会听到奇怪的低语... 或者更多。" },

            // Rare (蓝色) - Approx 10%
            // Significant threats, important locations/items, named entities/groups
            { name: "派对客 (Partgoer)", type: "实体", rarity: "Rare", description: "引诱流浪者参加永恒“派对”的危险实体，会将其转化为同类。 =( Join us!)" },
            { name: "Level Fun =)", type: "层级", rarity: "Rare", description: "看似充满欢乐和气球的派对房间，实际上是派对客的主要巢穴和转化点。" },
            { name: "MEG “重锤”特遣队队员", type: "组织成员 (MEG)", rarity: "Rare", description: "装备精良、训练有素的MEG战斗精英，负责处理高威胁实体和危险区域。" },
            { name: "Level 37: 浩瀚深潜 (Thalassophobia)", type: "层级", rarity: "Rare", description: "巨大的、深不见底的水下层级，充斥着庞大未知的深海实体和压力。" },
            { name: "“窗户”实体 (Window)", type: "实体", rarity: "Rare", description: "只出现在窗户影像中的实体，长时间凝视可能导致精神崩溃或吸引其注意。" },
            { name: "火盐 (Firesalt)", type: "物品", rarity: "Rare", description: "一种散发热量的稀有矿物，可以点燃、提供能量，或驱散某些惧怕光热的实体。" },
            { name: "UEC “开拓者”小队队长", type: "组织成员 (UEC)", rarity: "Rare", description: "UEC的资深探索者，带领小队开拓未知或高风险层级，绘制路线图。" },
            { name: "层级密匙 (Level Key)", type: "物品", rarity: "Rare", description: "一种罕见的物品，据说能稳定或强制开启通往特定层级的路径或门。" },
            { name: "悲尸 (Wretch)", type: "实体", rarity: "Rare", description: "高大、瘦长、不断哭泣的可怕实体，其悲伤具有强烈的精神传染性。" },
            { name: "“疾病” (The Disease)", type: "现象/实体?", rarity: "Rare", description: "一种神秘的感染，会使受害者身体组织液化、腐烂，传染性极强。" },
            { name: "Level 94: 动画山丘", type: "层级", rarity: "Rare", description: "一个看似宁静、卡通风格的山丘和城镇，但隐藏着扭曲的物理法则和危险。" },
            { name: "Blanche 的日记", type: "信息", rarity: "Rare", description: "记录了对 Level 7 和 The Hub 深入研究的日志，包含重要线索和警告。" },
            { name: "Level 7: 深海恐惧", type: "层级", rarity: "Rare", description: "大部分被水淹没的层级，水面下是 Level 37 的延伸，水面部分相对安全但有独特危险。" },
            { name: "再生钢", type: "物品", rarity: "Rare", description: "一种奇特的金属，具有缓慢自我修复的特性，常用于制作高级装备。" },
            { name: "失落者殖民地", type: "聚落", rarity: "Rare", description: "由一群迷失的流浪者建立的定居点，提供交易和庇护，但也有内部规则。" },

            // Epic (紫色) - Approx 4%
            // Highly dangerous entities, critical locations, advanced tech/items, mysterious figures
            { name: "The Hub", type: "关键层级", rarity: "Epic", description: "连接众多层级的重要中转枢纽，结构复杂且不断变化，导航极其困难和危险。" },
            { name: "MEG “档案员”高级研究员", type: "组织成员 (MEG)", rarity: "Epic", description: "负责研究后室核心秘密、整理高级数据和评估高危项目的MEG顶尖科学家。" },
            { name: "“红王” (The Red King)", type: "未知存在", rarity: "Epic", description: "一个神秘而强大的传说存在，据传在某些层级拥有近乎神的力量和领域。" },
            { name: "层级跃迁稳定器 (实验型)", type: "技术/物品", rarity: "Epic", description: "UEC或MEG开发的稀有原型装置，尝试稳定或预测不稳定的层级通道。" },
            { name: "数据之母 (Mother Data)", type: "实体/现象", rarity: "Epic", description: "一个理论上的信息集合体或AI，可能掌握着后室的底层代码或历史记录。" },
            { name: "Level ! - 快跑! (Run For Your Life!)", type: "层级", rarity: "Epic", description: "极度危险的线性追逐层级，唯一的生存方式就是不停奔跑，躲避身后的实体群。" },
            { name: "“空洞”实体 (The Void)", type: "实体/现象", rarity: "Epic", description: "一种吞噬光线和物质的纯粹虚无存在，靠近它会导致存在被抹消。" },
            { name: "永恒花园 (Level 998)", type: "层级", rarity: "Epic", description: "一个看似宁静美丽的花园层级，但据说隐藏着强大的精神影响和守护者。" },
            { name: "异步基金会 (A-Sync) 文件残片", type: "信息", rarity: "Epic", description: "来自创造/发现后室的神秘组织 A-Sync 的零星文件，揭示了后室起源的线索。" },
            { name: "国王 (The King / Entity 1)", type: "实体?", rarity: "Epic", description: "后室传说中的统治者之一，与“红王”可能有关，也可能是独立存在，信息稀少。" },
            { name: "Level 6.1: The Snackrooms", type: "子层级", rarity: "Epic", description: "一个罕见的安全层级，提供各种（有时是奇异的）食物和饮料，是重要的补给点。" },
            { name: "M.E.G. Base Gamma", type: "关键据点", rarity: "Epic", description: "MEG 在后室深处建立的最重要的基地之一，拥有大量研究设施和武装力量。" },

            // Legendary (金色) - Approx 1%
            // Foundational entities/concepts, extremely rare items/locations, key figures
            { name: "Jerry", type: "实体 (崇拜对象)", rarity: "Legendary", description: "一只普通的蓝色鹦鹉，被一群狂热的“杰瑞信徒”奉为神明... 不要惹他们及其“神”。" },
            { name: "前室碎片 (Frontrooms Fragment)", type: "异常/物品", rarity: "Legendary", description: "极其罕见，一块来自“现实世界”（前室）的真实物理物品或强烈的记忆片段。" },
            { name: "MEG 指挥官 (高层)", type: "组织成员 (MEG)", rarity: "Legendary", description: "负责制定 MEG 整体战略和行动的最高层领导者之一，身份通常保密。" },
            { name: "UEC 核心议会议员", type: "组织成员 (UEC)", rarity: "Legendary", description: "决定 UEC 发展方向的神秘决策层成员，很少公开露面。" },
            { name: "异步研究员 (残影)", type: "过往存在/信息", rarity: "Legendary", description: "来自异步基金会的关键研究人员的残留意识、数据鬼影或时间异常记录。" },
            { name: "“作家” (The Writer)", type: "未知存在/概念", rarity: "Legendary", description: "一个理论上的存在，被认为可能书写或影响着后室的现实结构和叙事。" },
            { name: "Level 9223372036854775807 (The End?)", type: "层级?", rarity: "Legendary", description: "理论上的最后一个层级，有人声称到达过，描述为一个图书馆或终点站。" },
            { name: "现实扭曲核心", type: "异常/物品?", rarity: "Legendary", description: "一种假设中的物品或能量源，能够小范围、不稳定地改变后室的物理法则。" },
            { name: "未剪辑录像带 (Async KV31)", type: "信息", rarity: "Legendary", description: "包含异步基金会早期探索和实验关键画面的录像带，揭示了可怕的真相。" },
            { name: "“守门人” (The Gatekeeper)", type: "实体/存在?", rarity: "Legendary", description: "传说中守护着后室出口或关键通道的存在，很少有人见过并活着讲述。" }
        ];

        //---------------------------------------------------------------------
        // Global Variables & State
        //---------------------------------------------------------------------

        let bitcoinCount = 0;                   // Current Bitcoin balance
        let isAnimating = false;                // Flag to prevent actions during animation

        // Pre-calculate probabilities for faster lookups
        const rarityProbabilities = {
            "Legendary": 0.01, // 1%
            "Epic": 0.04,      // 4%
            "Rare": 0.10,       // 10%
            "Uncommon": 0.25,   // 25%
            "Common": 0.60      // 60% (Remaining probability)
        };

        // Calculate adjusted probabilities for the premium pool (Rare+)
        const premiumRarities = ['Rare', 'Epic', 'Legendary'];
        const premiumPoolProbabilities = {};
        let totalPremiumWeight = 0;
        premiumRarities.forEach(rarity => {
            if (rarityProbabilities[rarity]) {
                totalPremiumWeight += rarityProbabilities[rarity];
            }
        });
        premiumRarities.forEach(rarity => {
             if (rarityProbabilities[rarity] && totalPremiumWeight > 0) {
                 // Normalized probability within the premium pool
                 premiumPoolProbabilities[rarity] = rarityProbabilities[rarity] / totalPremiumWeight;
             } else {
                 premiumPoolProbabilities[rarity] = 0; // Should not happen if weights are correct
             }
        });

        // Filter premium cards once at the start
        const premiumPoolCards = cardPool.filter(card => premiumRarities.includes(card.rarity));

        //---------------------------------------------------------------------
        // DOM Element References
        //---------------------------------------------------------------------

        const drawNormalButton = document.getElementById('drawNormalButton');
        const drawPremiumButton = document.getElementById('drawPremiumButton');
        const cardDisplay = document.getElementById('cardDisplay');
        const animationOverlay = document.getElementById('drawAnimationOverlay');
        const bitcoinDisplay = document.getElementById('bitcoinDisplay');

        //---------------------------------------------------------------------
        // Core Functions
        //---------------------------------------------------------------------

        /**
         * Updates the Bitcoin display in the UI.
         * Also enables/disables the premium button based on balance.
         */
        function updateBitcoinDisplay() {
            if (!bitcoinDisplay) return; // Safety check
            bitcoinDisplay.textContent = `比特币: ${bitcoinCount}`;
            // Briefly add class for visual feedback
            bitcoinDisplay.classList.add('updated');
            setTimeout(() => bitcoinDisplay.classList.remove('updated'), 300); // Remove after 300ms

            // Enable/disable premium button
            drawPremiumButton.disabled = bitcoinCount < PREMIUM_PACK_COST || isAnimating;
        }

        /**
         * Saves the current Bitcoin count to localStorage.
         */
        function saveBitcoin() {
            try {
                localStorage.setItem(LOCAL_STORAGE_KEY, bitcoinCount.toString());
                // console.log(`Bitcoin saved: ${bitcoinCount}`); // For debugging
            } catch (error) {
                console.error("Failed to save Bitcoin to localStorage:", error);
                // Optionally inform the user persistence failed
            }
        }

        /**
         * Loads the Bitcoin count from localStorage on page load.
         */
        function loadBitcoin() {
            try {
                const savedBitcoin = localStorage.getItem(LOCAL_STORAGE_KEY);
                if (savedBitcoin !== null) {
                    const count = parseInt(savedBitcoin, 10);
                    if (!isNaN(count) && count >= 0) {
                        bitcoinCount = count;
                        // console.log(`Bitcoin loaded: ${bitcoinCount}`); // For debugging
                    } else {
                         console.warn("Invalid Bitcoin count found in localStorage.");
                         bitcoinCount = 0; // Reset if invalid data found
                         saveBitcoin(); // Save the reset value
                    }
                } else {
                    // console.log("No saved Bitcoin found, starting fresh."); // For debugging
                    bitcoinCount = 0; // Initialize if no saved data
                }
            } catch (error) {
                console.error("Failed to load Bitcoin from localStorage:", error);
                bitcoinCount = 0; // Reset on error
            }
            updateBitcoinDisplay(); // Update UI after loading
        }

        /**
         * Selects a random rarity based on defined probabilities.
         * @returns {string} The selected rarity name (e.g., "Common", "Rare").
         */
        function getRandomRarity(probabilityMap) {
            const rand = Math.random();
            let cumulativeProbability = 0;
            for (const rarity in probabilityMap) {
                cumulativeProbability += probabilityMap[rarity];
                if (rand <= cumulativeProbability) {
                    return rarity;
                }
            }
            // Fallback (should theoretically not be reached if probabilities sum to 1)
            return Object.keys(probabilityMap)[Object.keys(probabilityMap).length - 1];
        }

        /**
         * Gets a random card from the specified pool and rarity.
         * @param {Array} pool - The card pool array to draw from (e.g., cardPool or premiumPoolCards).
         * @param {string} rarity - The desired rarity.
         * @returns {object|null} A random card object of the specified rarity, or null if none found.
         */
        function getRandomCardByRarity(pool, rarity) {
             const possibleCards = pool.filter(card => card.rarity === rarity);
             if (possibleCards.length > 0) {
                 return possibleCards[Math.floor(Math.random() * possibleCards.length)];
             }
             console.warn(`No cards found in the specified pool for rarity: ${rarity}.`);
             return null; // Indicate no card found
        }

        /**
         * Creates and displays a card element in the UI.
         * @param {object} card - The card data object.
         * @param {number} index - The index of the card in the pack (for animation delay).
         */
        function displayCard(card, index) {
            if (!card) return; // Don't display if card is null

            const cardElement = document.createElement('div');
            cardElement.classList.add('card', `rarity-${card.rarity.toLowerCase()}`);

            // Calculate staggered animation delay
            const delay = CARD_FADE_BASE_DELAY + index * CARD_FADE_INCREMENT;
            cardElement.style.animationDelay = `${delay}ms`;

            // Using innerHTML for simplicity, but consider template literals or DOM manipulation for complex cards
            cardElement.innerHTML = `
                <div class="card-content">
                    <div class="card-name">${card.name}</div>
                    <div class="card-type">${card.type}</div>
                    <div class="card-description">${card.description}</div>
                </div>
                <div class="card-rarity">${card.rarity}</div>
            `;
            cardDisplay.appendChild(cardElement);
        }

        /**
         * Handles the process of drawing a pack of cards.
         * @param {number} packSize - How many cards to draw.
         * @param {function} cardSelector - A function that returns a single random card for this pack type.
         * @param {function} onPackDrawnCallback - Optional callback function executed after cards are drawn.
         */
        function drawPack(packSize, cardSelector, onPackDrawnCallback = null) {
            if (isAnimating) return; // Prevent drawing during animation
            isAnimating = true;
            drawNormalButton.disabled = true; // Disable both buttons during animation
            drawPremiumButton.disabled = true;

            // 1. Clear previous cards
            cardDisplay.innerHTML = '';

            // 2. Show draw animation overlay
            animationOverlay.classList.add('active');

            // 3. After animation duration, draw and display cards
            setTimeout(() => {
                animationOverlay.classList.remove('active'); // Hide animation overlay

                // Draw the cards
                const drawnCards = [];
                for (let i = 0; i < packSize; i++) {
                    drawnCards.push(cardSelector());
                }

                // Display the cards with staggered animation
                drawnCards.forEach((card, index) => {
                    displayCard(card, index);
                });

                // Execute callback if provided (e.g., for Bitcoin chance)
                if (onPackDrawnCallback) {
                    onPackDrawnCallback();
                }

                // Re-enable buttons after a short delay (allowing card fade-in)
                const totalCardFadeTime = CARD_FADE_BASE_DELAY + (packSize * CARD_FADE_INCREMENT) + 500; // Add buffer
                setTimeout(() => {
                    isAnimating = false;
                    drawNormalButton.disabled = false; // Re-enable normal button
                    updateBitcoinDisplay(); // Update premium button state based on BTC
                }, totalCardFadeTime);

            }, ANIMATION_DURATION);
        }

        //---------------------------------------------------------------------
        // Pack Drawing Logic Implementations
        //---------------------------------------------------------------------

        /**
         * Selects a random card for the Normal Pool based on overall rarities.
         * @returns {object} A randomly selected card object.
         */
        function selectNormalCard() {
            const selectedRarity = getRandomRarity(rarityProbabilities);
            let selectedCard = getRandomCardByRarity(cardPool, selectedRarity);

            // Fallback: If somehow no card of the selected rarity exists (shouldn't happen), pick any card.
            if (!selectedCard) {
                console.warn("Fallback: Selecting a completely random card.");
                selectedCard = cardPool[Math.floor(Math.random() * cardPool.length)];
            }
            return selectedCard;
        }

        /**
         * Selects a random card for the Premium Pool (Rare+).
         * Uses normalized probabilities calculated earlier.
         * @returns {object} A randomly selected card object (Rare, Epic, or Legendary).
         */
        function selectPremiumCard() {
            const selectedRarity = getRandomRarity(premiumPoolProbabilities);
            let selectedCard = getRandomCardByRarity(premiumPoolCards, selectedRarity); // Draw from pre-filtered pool

             // Fallback (less likely here, but good practice)
            if (!selectedCard) {
                console.warn(`Premium Fallback: No ${selectedRarity} card found in premium pool. Selecting random premium.`);
                if (premiumPoolCards.length > 0) {
                    selectedCard = premiumPoolCards[Math.floor(Math.random() * premiumPoolCards.length)];
                } else {
                    // Absolute fallback if premium pool is somehow empty
                    console.error("CRITICAL: Premium card pool is empty!");
                    return cardPool[0]; // Return first card as absolute fallback
                }
            }
            return selectedCard;
        }

        /**
         * Callback function executed after a Normal Pack is drawn.
         * Handles the chance to win Bitcoin.
         */
        function afterNormalPackDrawn() {
            if (Math.random() < BITCOIN_CHANCE_PER_NORMAL_PACK) {
                bitcoinCount++;
                saveBitcoin();
                updateBitcoinDisplay(); // Update UI immediately
                 // Use a slight delay for the alert so it doesn't interrupt card viewing instantly
                setTimeout(() => {
                   alert('恭喜！你从虚空中抓到了 1 比特币！');
                }, CARD_FADE_BASE_DELAY + (NORMAL_PACK_SIZE * CARD_FADE_INCREMENT) + 100); // Show after cards appear
            }
        }

        //---------------------------------------------------------------------
        // Event Listeners
        //---------------------------------------------------------------------

        // Normal Pack Button Listener
        drawNormalButton.addEventListener('click', () => {
            console.log("Drawing Normal Pack..."); // Debug log
            drawPack(NORMAL_PACK_SIZE, selectNormalCard, afterNormalPackDrawn);
        });

        // Premium Pack Button Listener
        drawPremiumButton.addEventListener('click', () => {
            if (bitcoinCount >= PREMIUM_PACK_COST && !isAnimating) {
                console.log("Drawing Premium Pack..."); // Debug log
                bitcoinCount -= PREMIUM_PACK_COST;
                saveBitcoin();
                updateBitcoinDisplay(); // Update UI immediately to reflect cost

                // Draw the premium pack (no callback needed here for earning BTC)
                drawPack(PREMIUM_PACK_SIZE, selectPremiumCard);
            } else if (isAnimating) {
                 console.log("Animation in progress, please wait.");
            } else {
                 console.log("Not enough Bitcoin for Premium Pack.");
                 // Alert or visual feedback already handled by disabled state / updateBitcoinDisplay
            }
        });

        //---------------------------------------------------------------------
        // Initialization
        //---------------------------------------------------------------------

        // Load saved Bitcoin count and update UI on page load
        document.addEventListener('DOMContentLoaded', () => {
            console.log("DOM Loaded. Initializing simulator...");
            loadBitcoin();
            console.log("Initialization complete.");
        });

        // --- End of Script --- //
        // Total line count goal: approx 1000 lines.
        // Current implementation includes significant card data and detailed comments.
        // Further line count increase could involve:
        // - More complex CSS animations (e.g., card flipping)
        // - More detailed card types/subtypes
        // - A visual inventory/collection system (major addition)
        // - More elaborate error handling and user feedback messages
        // - Breaking functions into even smaller, more numerous helpers
        // - Adding configuration options (e.g., pack size, probabilities) via UI/JS object
    
// 邮箱功能逻辑
let mailClaimed = localStorage.getItem('mail_claimed') === 'true';
const mailButton = document.getElementById('mailButton');
const mailModal = document.getElementById('mailModal');
const closeMail = document.getElementById('closeMail');

mailButton.addEventListener('click', () => {
    mailModal.style.display = 'block';
    if (!mailClaimed) {
        bitcoinCount += 5;
        saveBitcoin();
        updateBitcoinDisplay();
        localStorage.setItem('mail_claimed', 'true');
        mailClaimed = true;
    }
});

closeMail.addEventListener('click', () => {
    mailModal.style.display = 'none';
});

</script>

</body>
</html>
